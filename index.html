function renderProducts() {
  const filtered = getFilteredProducts();
  productList.innerHTML = "";

  if (filtered.length === 0) {
    const empty = document.createElement("p");
    empty.textContent = "Aucun produit dans cette catÃ©gorie.";
    empty.style.padding = "10px";
    productList.appendChild(empty);
    return;
  }

  let arRendered = false;

  filtered.forEach(prod => {
    const card = document.createElement("div");
    card.className = "product-card";

    const info = document.createElement("div");
    info.className = "product-info";

    const name = document.createElement("h3");
    name.className = "product-name";
    name.textContent = prod.name;

    const desc = document.createElement("p");
    desc.className = "product-desc";
    desc.textContent = prod.description;

    info.appendChild(name);
    info.appendChild(desc);

    const media = document.createElement("div");
    media.className = "product-media";

    const ext = prod.file.split('.').pop().toLowerCase();

    if (ext === "glb" && !arRendered) {
      const mv = document.createElement("model-viewer");
      mv.setAttribute("src", prod.file);
      mv.setAttribute("alt", prod.name);
      mv.setAttribute("camera-controls", "");
      mv.setAttribute("auto-rotate", "");
      mv.setAttribute("ar", "");
      mv.setAttribute("ar-modes", "webxr scene-viewer quick-look");
      mv.setAttribute("shadow-intensity", "1");
      mv.setAttribute("ar-scale", "fixed");
      media.appendChild(mv);
      arRendered = true;
    } else {
      const img = document.createElement("img");
      img.src = prod.file;
      img.alt = prod.name;
      img.style.width = "100%";
      img.style.height = "140px";
      img.style.objectFit = "cover";
      media.appendChild(img);
    }

    card.appendChild(media);
    card.appendChild(info);
    productList.appendChild(card);
  });
}
